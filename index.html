<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Chasse au trÃ©sor ğŸ‚</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: white;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1 { margin: 20px 0; }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      max-width: 600px;
      margin: 30px auto;
    }

    img {
      width: 100%;
      border-radius: 10px;
    }

    .locked {
      filter: blur(12px) grayscale(1) brightness(0.5);
    }

    #counter {
      font-size: 20px;
      margin-top: 20px;
    }

    #label {
      font-size: 24px;
      margin-top: 15px;
      min-height: 32px;
    }

    @keyframes pop {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    .pop {
      animation: pop 0.5s ease;
    }
  </style>
</head>

<body>

<h1>ğŸ Anniversaire LÃ©a ğŸ</h1>

<div class="grid">
  <img id="img1" class="locked" src="img1_locked.jpg">
  <img id="img2" class="locked" src="img2_locked.jpg">
  <img id="img3" class="locked" src="img3_locked.jpg">
  <img id="img4" class="locked" src="img4_locked.jpg">
  <img id="img5" class="locked" src="img5_locked.jpg">
  <img id="img6" class="locked" src="img6_locked.jpg">
  <img id="img7" class="locked" src="img7_locked.jpg">
  <img id="img8" class="locked" src="img8_locked.jpg">
  <img id="img9" class="locked" src="img9_locked.jpg">
</div>

<img id="img10" class="locked" src="img10_locked.jpg" style="max-width:300px;">
<img id="img11" class="locked" src="img11_locked.jpg" style="max-width:300px;">
<img id="img12" class="locked" src="img12_locked.jpg" style="max-width:300px;">

<div id="counter">0 / 12</div>
<div id="label"></div>

<script>
const TOTAL = 12;

/* ğŸ”¤ Textes personnalisÃ©s */
const labels = {
  1: "ğŸˆ DÃ©but de lâ€™aventure",
  2: "ğŸ° Indice cuisine",
  3: "ğŸ¶ Souvenir musical",
  4: "ğŸ“¸ Photo mystÃ¨re",
  5: "ğŸ  Coin du salon",
  6: "ğŸ Cadeau cachÃ©",
  7: "ğŸ•µï¸ Indice secret",
  8: "ğŸŒ¸ Moment doux",
  9: "ğŸ”¥ Presque fini",
  10: "ğŸ‰ Surprise finale",
  11: "ğŸ’– Souvenir spÃ©cial",
  12: "ğŸ† TrÃ©sor trouvÃ©"
};

let unlocked = JSON.parse(localStorage.getItem("unlocked")) || [];
let lastUnlocked = localStorage.getItem("lastUnlocked");

const params = new URLSearchParams(window.location.search);
const unlock = params.get("unlock");

const label = document.getElementById("label");

/* ğŸ”“ DÃ©blocage via QR */
if (unlock) {
  const n = Number(unlock);

  if (!unlocked.includes(n)) {
    unlocked.push(n);
    localStorage.setItem("unlocked", JSON.stringify(unlocked));
  }

  localStorage.setItem("lastUnlocked", n);
  lastUnlocked = n;

  /* âš¡ FIX : attendre le rendu DOM */
  setTimeout(() => {
    if (labels[n]) {
      label.textContent = labels[n];
      label.classList.remove("pop");
      void label.offsetWidth; // reset animation
      label.classList.add("pop");
    }
  }, 100);
}

/* ğŸ–¼ï¸ Appliquer images dÃ©bloquÃ©es */
unlocked.forEach(n => {
  const img = document.getElementById("img" + n);
  if (img) {
    img.src = "img" + n + ".jpg";
    img.classList.remove("locked");
    img.classList.add("pop");
  }
});

/* ğŸ·ï¸ Afficher texte mÃªme aprÃ¨s refresh */
if (lastUnlocked && labels[lastUnlocked]) {
  label.textContent = labels[lastUnlocked];
}

/* ğŸ”¢ Compteur */
document.getElementById("counter").textContent =
  unlocked.length + " / " + TOTAL;
</script>

</body>
</html>
